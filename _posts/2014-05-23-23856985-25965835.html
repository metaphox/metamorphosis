---
title: 怎么理解元编程？
layout: post
---
Meta- 这个前缀在希腊语中的本意是「在…后，越过…的」，类似于拉丁语的 post-，比如 metaphysics 就是「在物理学之后」，这个词最开始指一些亚里士多德的著作，因为它们通常排序在《物理学》之后。<br><br>但西方哲学界在几千年中渐渐赋予该词缀一种全新的意义：关于某事自身的某事。比如 meta-knowledge 就是「关于知识本身的知识」，meta-data 就是「关于数据的数据」，meta-language 就是「关于语言的语言」，而 meta-programming 也是由此而来，是「关于编程的编程」。<br><br>弄清了词源和字面意思，可知大陆将 meta- 这个前缀译为「元」并不恰当。台湾译为「后设」，稍微好一点点，但仍旧无法望文生义。也许「自相关」是个不错的选择，「自相关数据」、「自相关语言」、「自相关编程」——但是好像又太罗嗦了。<br><br>Anyway。先看看 meta-data：<br><br>「我的电话是 +86 123 4567 8910」<br>  ——这是一条数据；<br>「+86 123 4567 8910 有十三个数字和一个字符，前两位是国家代码，后面是一个移动电话号码」   —— 这是关于前面那条数据的数据。<br><br>那么照猫画虎，怎样才算 meta-programming 呢？泛泛来说，只要是与编程相关的编程就算是 meta-programming 了——比如，若编程甲可以输出 A - Z，那么写程序甲算「编程」；而程序乙可以<b>生成</b>程序甲（也许还会连带着运行它输出 A - Z），那么编写程序乙的活动，就可以算作 meta-programming，「元编程」。注意，程序甲和程序乙并不一定是同一种语言：<br><div class="highlight"><pre><code class="language-rb"><span class="p">(</span><span class="s1">'A'</span><span class="o">..</span><span class="s1">'Z'</span><span class="p">)</span><span class="o">.</span><span class="n">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">char</span><span class="o">|</span>
    <span class="nb">system</span><span class="p">(</span><span class="s2">"python -c 'print </span><span class="se">\"</span><span class="si">#{</span><span class="n">char</span><span class="si">}</span><span class="se">\"</span><span class="s2">'"</span><span class="p">)</span>
<span class="k">end</span>
</code></pre></div>如此说来，inline SQL 甚至动态生成 HTML 也是元编程了？抠定义的话是这样吧。<br><br>不过 metaprogramming 更狭义的意思应该是指「编写能改变语言语法特性或者运行时特性的程序」。换言之，一种语言本来做不到的事情，通过你编程来修改它，使得它可以做到了，这就是元编程。本版同文提及 method_missing，那么 <a href="https://link.zhihu.com/?target=https%3A//www.destroyallsoftware.com/talks/wat" class=" wrap external" target="_blank" rel="nofollow noreferrer">Wat —
    Destroy All Software   Talks<i class="icon-external"></i></a> 之中给出了运行时元编程的经典范例：<br><div class="highlight"><pre><code class="language-text">&gt;&gt; ruby has no bare words
NameError: undefined local variable or method `words' for main:Object
        from (irb) 1
&gt;&gt; def method_missing(*args); args.join(" "); end
=&gt; nil
&gt;&gt; ruby has bare words
=&gt; "ruby has bare words"
&gt;&gt; bare words can even have bangs!
=&gt; "bare words can even have bangs!"
</code></pre></div>C、C++、Python、JavaScript…… 多数流行的语言或多或少都有元编程能力；Lisp 诸方言更是以元编程为基本。而 Ruby 更是因为元编程易用又强大，被许多人拿来写 DSL，因为元编程可以捏出「本不存在的语法特性」来让书写 DSL 变得简单。
<hr>
原发布于 <a href="https://www.zhihu.com/question/23856985/answer/25965835">https://www.zhihu.com/question/23856985/answer/25965835</a></p>